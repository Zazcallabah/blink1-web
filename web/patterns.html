<!DOCTYPE html>
<html>
<head>
	<title>Blink(1) - patterns</title>
	<script type="text/javascript" src="raphael.js" charset="utf-8"></script>
	<script type="text/javascript" src="colorpicker.js" charset="utf-8"></script>
	<script type="text/javascript" src="knockout.js" charset="utf-8"></script>
	<script type="text/javascript" src="api.js" charset="utf-8"></script>
	<style type="text/css">
		input{
			width: 40px
		}
	</style>

	<script type="text/javascript">
	
	var presets = [{"name":"red flashes","lines":[{"color":"#ff0000","time":500,"ledn":0},{"color":"#000000","time":500,"ledn":0}]},{"name":"green flashes","lines":[{"color":"#00ff00","time":500,"ledn":0},{"color":"#000000","time":500,"ledn":0}]},{"name":"blue flashes","lines":[{"color":"#0000ff","time":500,"ledn":0},{"color":"#000000","time":500,"ledn":0}]},{"name":"white flashes","lines":[{"color":"#ffffff","time":500,"ledn":0},{"color":"#000000","time":500,"ledn":0}]},{"name":"yellow flashes","lines":[{"color":"#ffff00","time":500,"ledn":0},{"color":"#000000","time":500,"ledn":0}]},{"name":"purple flashes","lines":[{"color":"#ff00ff","time":500,"ledn":0},{"color":"#000000","time":500,"ledn":0}]},{"name":"groovy","lines":[{"color":"#ff4cff","time":1000,"ledn":0},{"color":" #630000","time":200,"ledn":0},{"color":"#0000ff","time":100,"ledn":0}]},{"name":"policecar","lines":[{"color":" #ff0000","time":300,"ledn":1},{"color":" #0000ff","time":300,"ledn":2},{"color":" #000000","time":100,"ledn":0},{"color":" #ff0000","time":300,"ledn":2},{"color":" #0000ff","time":300,"ledn":1},{"color":" #000000","time":100,"ledn":0}]},{"name":"fireengine","lines":[{"color":" #ff0000","time":300,"ledn":1},{"color":" #ff0000","time":300,"ledn":2},{"color":" #000000","time":100,"ledn":0},{"color":" #ff0000","time":300,"ledn":2},{"color":" #ff0000","time":300,"ledn":1},{"color":" #000000","time":100,"ledn":0}]},{"name":"palete colors","lines":[{"color":"#e7009a","time":1000,"ledn":0},{"color":"#3d00e7","time":1000,"ledn":0},{"color":"#00b8e7","time":1000,"ledn":0},{"color":"#00e71e","time":1000,"ledn":0},{"color":"#d7e700","time":1000,"ledn":0},{"color":"#e70000","time":1000,"ledn":0},{"color":"#e7e7e7","time":1000,"ledn":0}]},{"name":"CMYK","lines":[{"color":"#00fff2","time":800,"ledn":0},{"color":"#000000","time":300,"ledn":0},{"color":"#65003c","time":800,"ledn":0},{"color":"#000000","time":300,"ledn":0},{"color":"#ffd905","time":800,"ledn":0},{"color":"#000000","time":100,"ledn":0},{"color":"#000000","time":700,"ledn":0}]},{"name":"RGB","lines":[{"color":"#ff0000","time":800,"ledn":0},{"color":"#000000","time":300,"ledn":0},{"color":"#00ff00","time":800,"ledn":0},{"color":"#000000","time":300,"ledn":0},{"color":"#0000ff","time":800,"ledn":0},{"color":"#000000","time":300,"ledn":0}]},{"name":"undervolt","lines":[{"color":"#821500","time":1000,"ledn":0},{"color":"#634100","time":1000,"ledn":0},{"color":"#554f00","time":1000,"ledn":0},{"color":"#395800","time":1000,"ledn":0},{"color":"#00580b","time":1000,"ledn":0},{"color":"#005025","time":1000,"ledn":0},{"color":"#005844","time":1000,"ledn":0},{"color":"#00465a","time":1000,"ledn":0}]},{"name":"fire shrine","lines":[{"color":"#751100","time":0,"ledn":1},{"color":"#ff1d00","time":0,"ledn":2},{"color":"#ff1000","time":400,"ledn":1},{"color":"#680300","time":400,"ledn":2},{"color":"#000000","time":900,"ledn":1},{"color":"#e01200","time":0,"ledn":0},{"color":"#000000","time":2000,"ledn":0}]},{"name":"molten lava","lines":[{"color":"#ff0000","time":200,"ledn":1},{"color":"#ff0000","time":200,"ledn":2},{"color":"#bd0000","time":100,"ledn":1},{"color":"#bd0000","time":100,"ledn":2},{"color":"#690000","time":100,"ledn":1},{"color":"#690000","time":100,"ledn":2},{"color":"#3f0000","time":200,"ledn":1},{"color":"#3f0000","time":200,"ledn":2}]},{"name":"lighting storm","lines":[{"color":"#6f756f","time":0,"ledn":1},{"color":"#ffffff","time":0,"ledn":2},{"color":"#ffffff","time":400,"ledn":1},{"color":"#686868","time":400,"ledn":2},{"color":"#000000","time":900,"ledn":1},{"color":"#e0e0e0","time":0,"ledn":0},{"color":"#000000","time":2000,"ledn":0}]},{"name":"rain","lines":[{"color":"#0a01ff","time":100,"ledn":1},{"color":"#04004f","time":0,"ledn":1},{"color":"#1701ff","time":400,"ledn":2},{"color":"#04004f","time":0,"ledn":2},{"color":"#0019ff","time":300,"ledn":1},{"color":"#04004f","time":300,"ledn":1},{"color":"#1b01ff","time":300,"ledn":2},{"color":"#04004f","time":0,"ledn":2}]},{"name":"nightfall","lines":[{"color":"#001980","time":1000,"ledn":0},{"color":"#000000","time":10000,"ledn":0}]},{"name":"dawn","lines":[{"color":"#000000","time":1000,"ledn":0},{"color":"#ff6800","time":15000,"ledn":0}]},{"name":"dancefloor","lines":[{"color":"#ff0004","time":100,"ledn":1},{"color":"#ff0004","time":100,"ledn":2},{"color":"#f2ff00","time":100,"ledn":1},{"color":"#f2ff00","time":100,"ledn":2},{"color":"#00ff37","time":100,"ledn":1},{"color":"#00ff2a","time":100,"ledn":2},{"color":"#ff00aa","time":100,"ledn":1},{"color":"#ff00b6","time":100,"ledn":2}]},{"name":"rave","lines":[{"color":"#8b8800","time":0,"ledn":0},{"color":"#010b9e","time":100,"ledn":0},{"color":"#009b00","time":100,"ledn":0},{"color":"#a5008c","time":100,"ledn":0},{"color":"#01998e","time":100,"ledn":0},{"color":"#9b0007","time":100,"ledn":0},{"color":"#0114a5","time":100,"ledn":0},{"color":"#8c8d85","time":100,"ledn":0}]},{"name":"sexy","lines":[{"color":"#e7009a","time":400,"ledn":1},{"color":"#ff007b","time":0,"ledn":2},{"color":"#ff00dc","time":400,"ledn":1},{"color":"#680029","time":400,"ledn":2},{"color":"#000000","time":900,"ledn":1},{"color":"#e0006c","time":0,"ledn":0},{"color":"#53004d","time":2000,"ledn":0}]},{"name":"calmdown","lines":[{"color":"#00ff33","time":2000,"ledn":1},{"color":"#ff00e9","time":2000,"ledn":2},{"color":"#ff0004","time":2000,"ledn":1},{"color":"#003fff","time":2000,"ledn":2},{"color":"#faff00","time":2000,"ledn":1},{"color":"#ffffff","time":2000,"ledn":1}]},{"name":"emergency","lines":[{"color":"#ff7c01","time":0,"ledn":2},{"color":"#732f00","time":100,"ledn":0},{"color":"#ff7e00","time":0,"ledn":1},{"color":"#602700","time":300,"ledn":1}]},{"name":"lowbattery","lines":[{"color":"#7a0000","time":100,"ledn":0},{"color":"#000000","time":0,"ledn":0},{"color":"#7e0000","time":100,"ledn":0},{"color":"#000000","time":100,"ledn":0},{"color":"#000000","time":3000,"ledn":0}]},{"name":"EKG","lines":[{"color":"#0c4f00","time":0,"ledn":0},{"color":"#29ff00","time":0,"ledn":0},{"color":"#0c4f00","time":100,"ledn":0},{"color":"#29ff00","time":100,"ledn":0},{"color":"#0c4f00","time":2100,"ledn":0}]},{"name":"patternA","lines":[{"color":"#ff4cff","time":700,"ledn":0},{"color":"#630000","time":200,"ledn":0},{"color":"#00ff00","time":100,"ledn":0}]},{"name":"patternB","lines":[{"color":"#ff4cff","time":700,"ledn":0},{"color":"#630000","time":200,"ledn":0},{"color":"#0000ff","time":100,"ledn":0}]}];
	
	var api = new Api();
	var picker = undefined;
	
	function Pattern(source){
		if( !source )
			source ={};
		this.r = ko.observable(0);
		this.g = ko.observable(0);
		this.b = ko.observable(0);
		this.setColors( source.color || "#000000" );
		this.ledn = ko.observable(source.ledn || 0);
		this.time = ko.observable(source.time || 0);
		this.index = ko.observable(source.index || 0);
	};
	
	Pattern.prototype.grabColorFromPicker=function(){
		this.setColors(picker.latestColor);
	};
	
	Pattern.prototype.setColors = function(color){
		this.r(parseInt(color.substr(1,2),16));
		this.g(parseInt(color.substr(3,2),16));
		this.b(parseInt(color.substr(5,2),16));
	};
	
var hexconvert = function(num){
	var res = num.toString(16);
	if( num <= 0xf )
		return "0"+res;
	return res;
};

	Pattern.prototype.toObject = function(){
		return {
			color: "#" + 
				hexconvert(this.r()) + 
				hexconvert(this.g()) + 
				hexconvert(this.b()),
			ledn: this.ledn(),
			time: this.time(),
			index: this.index()
		};
	};
	
	var model = {
		patterns: ko.observableArray([]),
		selected: ko.observable(),
		presets: ko.observableArray(presets)
	};
	
	model.selected.subscribe(function(s){
		var startindex = 32-s.lines.length;
		for( var i = 0;i<s.lines.length; i++ )
		{
			
			model.patterns()[startindex+i].setColors( s.lines[i].color );
			model.patterns()[startindex+i].ledn( s.lines[i].ledn );
			model.patterns()[startindex+i].time( s.lines[i].time );
		}
	});

	window.onload = function() {
		picker = new Pick( "colorpicker" );
		for(var i=0;i<32;i++)
		{
			model.patterns.push(new Pattern({color:"#000000",ledn:0,time:0,index:i}));
		}
	/*	api.readPatterns(function(p){
			model.patterns(p.map( function(ps){ return new Pattern(ps); } ) );
		});
		*/
		ko.applyBindings(model);
	};
	</script>
</head>

<body style="margin-top: 350px">
<select data-bind="value:selected, options:presets, optionsText:'name', optionsCaption: 'Presets'"></select>
<ol start="0" data-bind="foreach: patterns">
	<li>
		<button data-bind="click: grabColorFromPicker">Grab</button>
		R: <input data-bind="value: r" />
		G: <input data-bind="value: g" />
		B: <input data-bind="value: b" />
		<select data-bind="value: ledn" >
			<option value="0">Both leds</option> 
			<option value="1">Led A</option> 
			<option value="2">Led B</option>
		</select> | 
		<input data-bind="value: time" /> ms
	</li>
</ol>

	<div id="colorpicker" style="width:300px; height:300px; position:absolute; top:0; left:0"></div>

</body>
</html>
