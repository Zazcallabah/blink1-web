<!DOCTYPE html>
<html>
<head>
	<title>Blink(1) - patterns</title>
	<script type="text/javascript" src="knockout.js" charset="utf-8"></script>
	<script type="text/javascript" src="api.js" charset="utf-8"></script>
	<script type="text/javascript" src="presets.js" charset="utf-8"></script>
	<script type="text/javascript" src="patterns.js" charset="utf-8"></script>
	<style type="text/css">
	#cled1, #cled2 {
		width: 100px;
		height: 100px;
		margin: 20px;
		border: 2px solid black;
	}
		li{
			margin: 5px;
			padding: 5px;
			border-style: dotted;
			border-color: black;
			border-width: 0 0 0 1px;
		}
	</style>

	<script type="text/javascript">
	var updateCurrent = function(callback){
		api.getCurrentColor( function(l){
			document.getElementById("cled1").style.backgroundColor = l.ledA;
			document.getElementById("cled2").style.backgroundColor = l.ledB;
			if( callback )
				callback();
		});
	};
	var model = {
		selected: ko.observable(presets[0]),
		presets: ko.observableArray(presets),
	};

	var api = new Api();

	model.go = function(){
		var l = [];
		for( var i = 0; i< 32; i++ )
		{
			if( i < this.selected().lines.length )
				l.push( this.selected().lines[i] );
			else l.push({});
			l[i].index = i;
		}
		api.savePatterns( l, function(){api.play(0,0,model.selected().lines.length-1)} );
		var stop = false;
		window.setTimeout( function(){
			stop=true;
		},10000 );
		function loopUpdate(){
			updateCurrent(function(){
				if( !stop )
					window.setTimeout( loopUpdate, 100 );
			});
		};
		loopUpdate();

	};

	window.onload = function() {
		ko.applyBindings(model);
		updateCurrent();
	};
	
	</script>
</head>

<body>

<p><select data-bind="value:selected, options:presets, optionsText:'name', optionsCaption: 'Presets'"></select></p>
<button data-bind="click:go">Go</button>

<ul><li id="cled1">&nbsp;</li><li id="cled2">&nbsp;</li></ul>

<hr>

	<p>
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="patternsadv.html">Advanced pattern creator</a></li>
			<li><a href="settings.html">Settings</a></li>
		</ul>
	</p>

</body>
</html>
