<!DOCTYPE html>
<html>
<head>
	<title>Blink(1) - patterns</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script type="text/javascript" src="knockout.js" charset="utf-8"></script>
	<script type="text/javascript" src="api.js" charset="utf-8"></script>
	<script type="text/javascript" src="presets.js" charset="utf-8"></script>
	<script type="text/javascript" src="patterns.js" charset="utf-8"></script>
	<link href="bootstrap.min.css" rel="stylesheet">
	<style type="text/css">
	#cled1, #cled2 {
		height: 100px;
		border: 2px solid black;
	}
	</style>

	<script type="text/javascript">
	var updateCurrent = function(callback){
		api.getCurrentColor( function(l){
			document.getElementById("cled1").style.backgroundColor = l.ledA;
			document.getElementById("cled2").style.backgroundColor = l.ledB;
			if( callback )
				callback();
		});
	};
	var model = {
		selected: ko.observable(presets[0]),
		presets: ko.observableArray(presets),
	};

	var api = new Api();

	model.go = function(){
		var l = [];
		for( var i = 0; i< 32; i++ )
		{
			if( i < this.selected().lines.length )
				l.push( this.selected().lines[i] );
			else l.push({});
			l[i].index = i;
		}
		api.savePatterns( l, function(){api.play(0,0,model.selected().lines.length-1)} );
		var stop = false;
		window.setTimeout( function(){
			stop=true;
		},10000 );
		function loopUpdate(){
			updateCurrent(function(){
				if( !stop )
					window.setTimeout( loopUpdate, 100 );
			});
		};
		loopUpdate();

	};

	window.onload = function() {
		ko.applyBindings(model);
		updateCurrent();
	};
	
	</script>
</head>

<body>

<div class="container-fluid">
	<div class="row">
		<div class="col-md-5">
		<h1>Patterns</h1>
			<form class="form-horizontal">
				<div class="form-group">
					<label for="select" class="col-sm-2 control-label">Preset</label>
					<div class="col-sm-10">
						<select id="select" class="form-control" data-bind="value:selected, options:presets, optionsText:'name'"></select>
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-2 col-sm-10">
						<button data-bind="click:go" class="btn btn-primary">Go</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class="row">&nbsp;</div>
	<div class="row">
		<div class="col-md-1"></div>
		<div id="cled1" class="col-md-1">&nbsp;</div>
		<div class="col-md-1"></div>
		<div id="cled2" class="col-md-1">&nbsp;</div>
		<div class="col-md-1"></div>
	</div>

	<div class="row">&nbsp;</div>

	<div class="row">
		<div class="col-md-5">
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="patternsadv.html">Advanced pattern creator</a></li>
				<li><a href="settings.html">Settings</a></li>
			</ul>
		</div>
	</div>
</div>
</body>
</html>
